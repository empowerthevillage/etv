{% extends 'base.html' %}
{% block title %}
ETV | Donate
{% endblock %}
{% block canonical %}https://www.empowerthevillage.org/donation/{% endblock %}
{% block seo_description %}Empower The Village Needs Your Support! Unleash the Power of The Village by donating $25, $50, $100, $500 or whatever you are inspired to invest in the community!{% endblock %}
{% load static %}

{% block content %}
  

<div id="page">

    <div class="content-container row" style="margin-bottom: 0">
        
        <div class="col s12 l7 right" style="padding-left: 3%;padding-right: 5%; padding-bottom: 3%">
          
          <h5 class="center-align donation-title">It Takes a Village to Restore Prosperity, Peace & Power to The Black Community!</h5>
          <h6 class="donation-subtitle center-align">Unleash the Power of The Village by donating  $25, $50, $100, $500 or whatever you are inspired to invest in the community!</h6>
          <div id="preloader" class="center-align" style="display:none; padding-top: 200px; height: 800px">
            <div class="preloader-wrapper big active" >
              <div class="spinner-layer spinner-blue">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>
            
              <div class="spinner-layer spinner-red">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>
            
              <div class="spinner-layer spinner-yellow">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>
            
              <div class="spinner-layer spinner-green">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                  <div class="circle"></div>
                </div><div class="circle-clipper right">
                  <div class="circle"></div>
                </div>
              </div>
            </div>
            </div>
          <div class="step-1">
            <form id="donation-form">
              {% csrf_token %}
              <input type="hidden" value="" id="device-data-input">
              <input type="hidden" value="" id="donation-level">
                <fieldset class="checkout-fieldset z-depth-1">
                    <div class="row" style="margin-bottom: 0">
                    <div class="col s12 valign-wrapper" style="padding-left: 0; padding-right: 0">
                      <h5 class="fieldset-title">Donate Now</h5><h6 class="valign-wrapper secure-checkout align" style="margin-bottom:0; margin-left: 10px"><span class="material-icons">
                        lock
                        </span>&nbsp;SECURE
                      </h6>
                      
                    </div>
                    <div class="col s12 xl6" style="margin-top: 0; margin-bottom: 0; padding-left: 0; padding-right: 0">
                    <input type="hidden" id="donation-level-input">
                    <input type="hidden" id="frequency-input">
                    <input type="hidden" id="frequency-verbose-input">
                      <p>
                          <label>
                          <input class="with-gap" name="donation_level" type="radio" value="25" plan-id='4w72'>
                          <span>Village Member - $25</span>
                          </label>
                      </p>
                      <p>
                          <label>
                          <input class="with-gap" name="donation_level" type="radio" value="50" plan-id="jtkb">
                          <span>Village Patron - $50</span>
                          </label>
                      </p>
                      <p>
                          <label>
                          <input class="with-gap" name="donation_level" type="radio" value="100" plan-id='bvd6'>
                          <span>Village Supporter - $100</span>
                          </label>
                      </p>
                    </div>
                    <div class="col s12 xl6" style="margin-top: 0; padding-left: 0; padding-right: 0">
                      <p>
                          <label>
                          <input class="with-gap" name="donation_level" type="radio" value="500" plan-id='rsrg'>
                          <span>Village Leader - $500</span>
                          </label>
                      </p>
                      <p class="">
                        <label>
                        <input class="with-gap" name="donation_level" type="radio" value="1000" plan-id='7vsm'>
                        <span>Village Ambassador - $1000</span>
                        </label>
                      </p>
                      <p id="custom-amount">
                        <label>
                          <input class="with-gap other" name="donation_level" type="radio">
                          <span>Other</span>
                        </label>
                      </p>
                      <div class="other-input hidden text-field">
                        <div class="valign-wrapper">$<input type="number" id="other-donation" style="width: 50%"></div>
                        <label>Enter a Custom Amount</label>
                      </div>
                    </div>
                    
                    </div>
                    <div class="row" style="margin-bottom: 0">
                    <div class="col s12" style="padding-left: 0; padding-right: 0">
                      <h6 class="fieldset-subtitle" style="margin-top: 10px">Founder's Circle</h6>
                    </div>
                    <div class="col s12 m6" style="padding-left: 0; padding-right: 0">
                      <p>
                        <label>
                          <input class="with-gap" name="donation_level" type="radio" value="5000" plan-id='nt5w'>
                          <span>Bronze - $5,000</span>
                        </label>
                      </p>
                      <p>
                        <label>
                          <input class="with-gap" name="donation_level" type="radio" value="10000" plan-id='ftyr'>
                          <span>Silver - $10,000</span>
                        </label>
                      </p>
                    </div>
                    <div class="col s12 m6" style="padding-left: 0; padding-right: 0">
                      <p>
                        <label>
                          <input class="with-gap" name="donation_level" type="radio" value="15000" plan-id='vsc2'>
                          <span>Gold - $15,000</span>
                        </label>
                      </p>
                      <p>
                        <label>
                          <input class="with-gap" name="donation_level" type="radio" value="25000" plan-id='26fw'>
                          <span>Platinum - $25,000</span>
                        </label>
                      </p>
                    </div>
                    </div>
                    <div id="make-my-donation">
                        <div class="row" style='margin-bottom: 0'>
                          <h6 class="fieldset-title" style="color: rgb(23, 159, 23); margin-top: 20px">Please Make My Donation:</h6>
                          <div class="col s12">
                          
                              <div class="row" style="margin-bottom: 0;">
                                <p class="col s12 m6" style="padding-left:0 ; padding-right: 0">
                                  <label>
                                    <input class="with-gap" name="frequency" type="radio" value="once" confirm-display="A One Time Gift">
                                    <span>A One Time Gift</span>
                                  </label>
                                </p>
                                <p class="col s12 m6" style="padding-left: 0; padding-right: 0">
                                  <label>
                                    <input class="with-gap" name="frequency" type="radio" value="monthly" confirm-display="A Monthly Gift">
                                    <span>A Monthly Gift</span>
                                  </label>
                                </p>
                              </div>
                          </div>
                        </div>
                    </div>
                  
                </fieldset>
                <fieldset class="checkout-fieldset z-depth-1">
                  <h5 class="fieldset-title">Donor Details</h5>
                  <div class="row" style="margin-bottom: 0;">
                    <div class=" col s12 m6">
                        {{ mailing_form.first_name }}
                        <label>First Name<b class="required">*</b></label>
                    </div>
                    <div class=" col s12 m6">
                      <input type="text" required id="last_name">
                      <label>Last Name<b class="required">*</b></label>
                    </div>
                    <div class=" col s12 m8" style="margin-top: 0">
                      <input type="text" required id="email">
                      <label>Email<b class="required">*</b></label>
                    </div>
                    <div class=" col s12 m4" style="margin-top: 0">
                      <input type="text" class="phone_us" id="phone">
                      <label>Phone (Optional)</label>
                    </div>
                    <div class=" col s12" style="margin-top: 0">
                      {{ mailing_form.address_line_1 }}
                      <label>Mailing Address</label>
                    </div>
                    <div class="col s12" style="margin-top: 0">
                      {{ mailing_form.address_line_2 }}
                      <label>{{ mailing_form.address_line_2.label }}</label>
                    </div>
                    <div class="col s12 m5" style="margin-top: 0">
                      {{ mailing_form.city }}
                      <label>City</label>
                    </div>
                    <div class="col s12 m4 input-field" style="margin-top: 0">
                      {{ mailing_form.state }}
                      <label>State</label>
                    </div>
                    <div class=" col s12 m3" style="margin-top: 0">
                      {{ mailing_form.zip }}
                      <label>{{ mailing_form.zip.label }}</label>
                    </div>
                  </div>
                </fieldset>
                <div class="row">
                  <div class="col s10 offset-s1 m6 offset-m3" style="padding-left:0; padding-right: 0">
                    <button class="valign-wrapper btn waves-effect creditcard-button step1-create z-depth-0" id="creditcard-button">
                      <div class="donate-text-small"><i class="fas fa-credit-card"></i> DONATE</div><div class="donate-text-large"><i class="fas fa-credit-card"></i> DONATE</div>
                    </button>
                    <div class="valign-wrapper" style="display: flex; justify-content: center;">
                      <i class="fab fa-cc-visa" style="font-size: 32px; padding: 5px"></i>
                      <i class="fab fa-cc-mastercard" style="font-size: 32px; padding: 5px"></i>
                      <i class="fab fa-cc-discover" style="font-size: 32px; padding: 5px"></i>
                      <i class="fab fa-cc-amex" style="font-size: 32px; padding: 5px"></i>
                    </div>
                  </div>
                  <div class="col s12">
                  <div id="or">OR</div>
                  </div>
                  <div class="col s10 offset-s1 m6 offset-m3" style="padding-left:0; padding-right: 0">
                    <p class="help-text">Donate With:</p>
                    <button class="btn waves-effect google-button valign-wrapper z-depth-0" id="google-pay-button" style="border: solid 1px rgb(211, 211, 211)">
                      <img src="{% static 'img/googlepay-full.svg' %}" style="width: 60px; margin-left: 3px">
                    </button>
                  </div>
                  <!--
                  <div class="col s10 offset-s1 m4" style="padding-left:0; padding-right: 0">
                    <button class="btn waves-effect applepay-button valign-wrapper z-depth-0" id="apple-pay-button">
                      <img src="{% static 'img/applepay.svg' %}" style="width: 60px; padding-top: 0; margin-left: 3px">
                    </button>
                  </div>
                -->
                  <div class="col s10 offset-s1 m6 offset-m3" style="padding-left:0; padding-right: 0">
                    <div id="paypal-button" style="margin:5px; letter-spacing: 1.5px"></div>
                  </div>
                  <div class="col s10 offset-s1 m6 offset-m3" style="padding-left:0; padding-right: 0">
                    <button class="valign-wrapper btn waves-effect venmo-button z-depth-0" id="venmo-button" style="display:none;">
                      <img src="{% static 'img/venmo-white.svg' %}" style="width: 80px; margin-left: 2px">
                    </button>
                  </div>
                </div>
            </form>
            <div class="divider" style="margin-bottom: 15px"></div>
              <div class="col s12 center-align">
                <a href="https://www.braintreegateway.com/merchants/tb3vd7jd2hynhxcn/verified" target="_blank">
                  <img src="https://s3.amazonaws.com/braintree-badges/braintree-badge-wide-dark.png" width="280px" height ="44px" border="0"/>
                  </a>
              </div>
          </div>
          <div class="step-2 hidden">
            <div class="btn black" id="step2-back">Back</div>
            <form id="creditcard-form">
              {% csrf_token %}
              <input type="hidden" value="" id="nonce-input">
              <fieldset class="checkout-fieldset z-depth-1" style="padding-right: 7%">
                <div class="valign-wrapper" style="margin-bottom: 10px">
                <h5 class="fieldset-title">Payment Method</h5><h6 class="valign-wrapper secure-checkout align" style="margin-bottom:0; margin-left: 10px"><span class="material-icons">
                  lock
                  </span>&nbsp;SECURE
                </h6>
                </div>
                <div class="row">
                  <div class="col s12">
                    <label for="card-name">Cardholder Name</label>
                    <div id="card-name" class="valign-wrapper"><i class="fas fa-user-circle input-icon"></i></div>
                  </div>
                  <div class="col s12">
                    <label for="card-number">Card Number</label>
                    <div id="card-number" class="valign-wrapper"><i class="fas fa-credit-card input-icon"></i></div>
                  </div>
                  <div class="col s12 m4">
                    <label for="card-date">Expiration Date</label>
                    <div id="card-date" class="valign-wrapper"><i class="fas fa-calendar-day input-icon"></i></div>
                  </div>
                  <div class="col s6 m4">
                    <label for="card-cvv">CVV</label>
                    <div id="card-cvv" class="valign-wrapper"><i class="fas fa-lock input-icon"></i></div>
                  </div>
                  <div class="col s6 m4">
                    <label for="card-zip">ZIP</label>
                    <div id="card-zip" class="valign-wrapper"><i class="fas fa-globe-americas input-icon"></i></div>
                  </div>
                  <div class="col s10 offset-s1 m8 offset-m2 xl6 offset-xl3" style="padding-left:0; padding-right: 0">
                    <button class="valign-wrapper btn waves-effect creditcard-button  z-depth-0" id="cc-review-button">
                      <div class="donate-text-small"><i class="fas fa-search"></i> REVIEW</div>
                      <div class="donate-text-large"><i class="fas fa-search"></i> REVIEW</div>
                    </button>
                  </div>
                </div>
                
              </fieldset>
            </form>
            <div class="col s12 center-align">
              <a href="https://www.braintreegateway.com/merchants/tb3vd7jd2hynhxcn/verified" target="_blank">
                <img src="https://s3.amazonaws.com/braintree-badges/braintree-badge-wide-dark.png" width="280px" height ="44px" border="0"/>
                </a>
            </div>
          </div>
          <div class="step-3 hidden center-align">
            {% csrf_token %}
            <div class="btn black" id="step3-back">Back</div>
              <fieldset class="checkout-fieldset z-depth-1" style="padding-right: 7%">
                  <div class="" style="margin-bottom: 10px">
                    <h5 class="fieldset-title" style="font-size: 36px">Donation Summary</h5>
                  </div>
                  <div class="row">
                      <p class="donation-review-item" id="review-amount"><b>Donation Amount:</b></p>
                      <p class="donation-review-item" id="review-frequency"><b>Donation Frequency:</b></p>
                      <p class="donation-review-item" id="review-nonce"><b>Payment Method:</b></p>
                  </div>
                  
                <div class="col s10 offset-s1 m8 offset-m2" style="padding-left:0; padding-right: 0">
                <button class="valign-wrapper btn waves-effect creditcard-button z-depth-0" id="donation-submit-button">
                  <div class="donate-text-small"><i class="fas fa-check-circle"></i> Donate Now</div><div class="donate-text-large"><i class="fas fa-check-circle"></i> Donate Now</div>
                </button>
                </div>
              </fieldset>
            
            <div class="col s12 center-align">
              <a href="https://www.braintreegateway.com/merchants/tb3vd7jd2hynhxcn/verified" target="_blank">
                <img src="https://s3.amazonaws.com/braintree-badges/braintree-badge-wide-dark.png" width="280px" height ="44px" border="0"/>
                </a>
            </div>
          </div>
          <div class="step-4 hidden center-align">
              <fieldset class="checkout-fieldset z-depth-1" style="padding-right: 7%; padding-top: 5%; padding-bottom: 5%">
                  <div class="" style="margin-bottom: 10px">
                    <h5 class="fieldset-title" style="font-size: 36px">Thank You For Your Donation!</h5>
                    <p class="donation-review-item">You will receive an email receipt shortly.</p>
                  </div>
              </fieldset>
            
            <div class="col s12 center-align">
              <a href="https://www.braintreegateway.com/merchants/tb3vd7jd2hynhxcn/verified" target="_blank">
                <img src="https://s3.amazonaws.com/braintree-badges/braintree-badge-wide-dark.png" width="280px" height ="44px" border="0"/>
                </a>
            </div>
          </div>
        </div>
        <div class="col s12 l5 left center-align" style="border-right: dotted 1px rgba(182, 182, 182, 0.694); padding-left: 3%; padding-right: 3%;">
          <h5 class="donation-title">Empower The Village Needs Your Support!</h5>
          <h7 style="padding-top: 20px;">Our mission is to develop, guide and implement breakthrough, scalable strategies that <b>empower Black people, businesses and community organizations to realize their full potential.</b></h7>
          <iframe class="yt-video" src="https://www.youtube.com/embed/7ypFvkUOtwo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <style>
            
            .yt-video {
              height: 200px;
              margin-top: 5%;
              width: 90%
            }
            h7 {
              font-size: 16px;
            }
            @media only screen and (min-width: 663px){
              h7 {
                font-size: 18px;
              }
              .yt-video {
                height: 275px
              }
            }
            @media only screen and (min-width: 993px){
              
              .yt-video {
                width: 100%
              }
            }
            @media only screen and (min-width: 1201px){
             
              .yt-video {
                height: 350px
              }
            }
          </style>
      </div>
    </div> 
    
</div>
<script src="https://js.braintreegateway.com/web/3.82.0/js/client.min.js"></script>
<script src="https://js.braintreegateway.com/web/3.82.0/js/venmo.min.js"></script>
<script src="https://js.braintreegateway.com/web/3.82.0/js/data-collector.min.js"></script>
<script src="https://pay.google.com/gp/p/js/pay.js"></script>
<script src="https://js.braintreegateway.com/web/3.82.0/js/google-payment.min.js"></script>
<script src="https://js.braintreegateway.com/web/3.82.0/js/paypal-checkout.min.js"></script>
<script src="https://js.braintreegateway.com/web/3.82.0/js/hosted-fields.min.js"></script>
<script>
var venmoButton = document.getElementById('venmo-button');

braintree.client.create({
    authorization: 'production_pgz5pm7q_tb3vd7jd2hynhxcn'
  }, function (clientErr, clientInstance) {
  if (clientErr) {
    console.error('Error creating client:', clientErr);
    return;
  }
  braintree.hostedFields.create({
    client: clientInstance,
    styles: {
      'input': {
        'font-size': '16px',
        'color': 'black',
        'border-bottom': '1px solid #9e9e9e',
        'border-radius': '0',
        'outline': 'none',
        'height': '3rem',
        'font-family': 'poppins',
        'font-weight': '400',
        'letter-spacing': '1px',
        'margin-bottom': '10px',
      }
    },
    fields: {
      cardholderName: {
        container: '#card-name',
      },
      number: {
        container: '#card-number',
      },
      cvv: {
        container: '#card-cvv',
        masked: true
      },
      expirationDate: {
        container: '#card-date',
      },
      postalCode: {
        container: '#card-zip',
      }
    }
  }, function(hostedFieldsErr, hostedFieldsInstance){
    if (hostedFieldsErr){
      alert(hostedFieldsErr);
      return;
    }
    $('#cc-review-button').on('click', function(event){
      event.preventDefault();
      $('.step-2').addClass('hidden');
      window.scrollTo(0, 0);
      $('#preloader').show();
      hostedFieldsInstance.tokenize(function (tokenizeErr, payload) {
        if (tokenizeErr) {
          console.error(tokenizeErr);
          return;
        }
        var nonce_id = payload.nonce
        $('#nonce-input').attr('value', nonce_id);
        var frequencyVerbose = $('#frequency-verbose-input').val()
        var amount = $('#donation-level-input').val()
        var csrf_token = $('[name="csrfmiddlewaretoken"]', '#creditcard-form').val()
        var data = {
          csrfmiddlewaretoken: csrf_token,
          'nonce': nonce_id,
        }
        $.ajax({
          data: data,
          method: 'POST',
          url: '/donation/review',
          success: function(data){
            $('#review-amount').html('<b>Donation Amount:</b> $'+ amount)
            $('#review-frequency').html('<b>Donation Frequency:</b> '+frequencyVerbose)
            $('#review-nonce').html('<b>Payment Method:</b> '+ data['details'].card_type +' ending in '+ data['details'].last_four)
            $('#preloader').hide()
            $('.step-3').removeClass('hidden')
          },
          error: function(){
            Swal.fire(
              'An Error Occured',
              'Please Try Again',
              'error'
            )
          }
        });
      });
    });
  
  braintree.dataCollector.create({
    client: clientInstance,
    paypal: true
  }, function (dataCollectorErr, dataCollectorInstance) {
    if (dataCollectorErr) {
      return;
    }
    var deviceData = dataCollectorInstance.deviceData
    $('#device-data-input').attr('value', deviceData)
  });

  braintree.venmo.create({
    client: clientInstance,
    allowDesktop: true,
    paymentMethodUsage: 'multi_use',
    allowNewBrowserTab: false, 
  }, function (venmoErr, venmoInstance) {
    if (venmoErr) {
      console.error('Error creating Venmo:', venmoErr);
      return;
    }

    if (!venmoInstance.isBrowserSupported()) {
      console.log('Browser does not support Venmo');
      return;
    }

    displayVenmoButton(venmoInstance);
    if (venmoInstance.hasTokenizationResult()) {
      venmoInstance.tokenize(function (tokenizeErr, payload) {
        if (err) {
          handleVenmoError(tokenizeErr);
        } else {
          handleVenmoSuccess(payload);
        }
      });
      return;
    }
  });
  
  var paymentsClient = new google.payments.api.PaymentsClient({
    environment: 'TEST'
  });
  var googleButton = document.querySelector('#google-pay-button');
  
  braintree.googlePayment.create({
    client: clientInstance,
    googlePayVersion: 2,
    
  }, function (err, googlePaymentInstance) {
    paymentsClient.isReadyToPay({
      // see https://developers.google.com/pay/api/web/reference/object#IsReadyToPayRequest for all options
      apiVersion: 2,
      apiVersionMinor: 0,
      allowedPaymentMethods: googlePaymentInstance.createPaymentDataRequest().allowedPaymentMethods,
      existingPaymentMethodRequired: true
    }).then(function (isReadyToPay) {
      if (isReadyToPay.result) {
        googleButton.addEventListener('click', function(event){
          event.preventDefault();
          var totalPrice = $('#donation-level-input').val()
          var paymentDataRequest = googlePaymentInstance.createPaymentDataRequest({
            transactionInfo: {
              currencyCode: 'USD',
              totalPriceStatus: 'FINAL',
              totalPrice: totalPrice,
            }
          });
          var cardPaymentMethod = paymentDataRequest.allowedPaymentMethods[0];
          cardPaymentMethod.parameters.billingAddressRequired = false;
          paymentsClient.loadPaymentData(paymentDataRequest).then(function(paymentData){
            googlePaymentInstance.parseResponse(paymentData, function(err, result){
              
            })
          })
        })
      }
    });
  });
  braintree.paypalCheckout.create({
    client: clientInstance
  }, function(paypalCheckoutErr, paypalCheckoutInstance){
    if (paypalCheckoutErr){
      console.error('Paypal Error:',paypalCheckoutErr);
      return;
    }
    paypalCheckoutInstance.loadPayPalSDK({
      vault: true
    },function(){
      paypal.Buttons({
        fundingSource: paypal.FUNDING.PAYPAL,
        style: {
          color: 'gold',
          shape: 'pill',
          height: 50,
          width: 'responsive'
        },
        createBillingAgreement: function(){
          return paypalCheckoutInstance.createPayment({
            flow: 'vault',
          });
        },
        onApprove: function(data, actions) {
          event.preventDefault();
          $('.step-1').addClass('hidden');
          window.scrollTo(0, 0);
          $('#preloader').show();
          return paypalCheckoutInstance.tokenizePayment(data, function(err, payload){
            $('#nonce-input').attr('value', payload.nonce);
            var frequencyVerbose = $('#frequency-verbose-input').val()
            var amount = $('#donation-level-input').val()
            var csrf_token = $('[name="csrfmiddlewaretoken"]', '#creditcard-form').val()
            var data = {
              csrfmiddlewaretoken: csrf_token,
              'nonce': nonce_id,
            }
            $.ajax({
              data: data,
              method: 'POST',
              url: '/donation/review',
              success: function(data){
                $('#review-amount').html('<b>Donation Amount:</b> $'+ amount)
                $('#review-frequency').html('<b>Donation Frequency:</b> '+frequencyVerbose)
                $('#review-nonce').html('<b>Payment Method:</b> '+ data['details'].card_type +' ending in '+ data['details'].last_four)
                $('#preloader').hide()
                $('.step-3').removeClass('hidden')
              },
              error: function(){
                Swal.fire(
                  'An Error Occured',
                  'Please Try Again',
                  'error'
                )
              }
            });
            
          });
        },
        onCancel: function (data) {
          console.log('PayPal payment canceled', JSON.stringify(data, 0, 2));
        },

        onError: function (err) {
          console.error('PayPal error', err);
        },
      }).render('#paypal-button').then(function(){
        
      });
    });
  });

});

function displayVenmoButton(venmoInstance) {
  venmoButton.style.display = 'block';

  venmoButton.addEventListener('click', function () {
    venmoButton.disabled = true;

    venmoInstance.tokenize(function (tokenizeErr, payload) {
      venmoButton.removeAttribute('disabled');

      if (tokenizeErr) {
        handleVenmoError(tokenizeErr);
      } else {
        handleVenmoSuccess(payload);
      }
    });
  });
}

function handleVenmoError(err) {
  if (err.code === 'VENMO_CANCELED') {
    console.log('App is not available or user aborted payment flow');
  } else if (err.code === 'VENMO_APP_CANCELED') {
    console.log('User canceled payment flow');
  } else {
    console.error('An error occurred:', err.message);
  }
}

function handleVenmoSuccess(payload) {
  event.preventDefault();
  $('.step-1').addClass('hidden');
  window.scrollTo(0, 0);
  $('#preloader').show();
  var frequencyVerbose = $('#frequency-verbose-input').val()
            var amount = $('#donation-level-input').val()
            var csrf_token = $('[name="csrfmiddlewaretoken"]', '#creditcard-form').val()
            var data = {
              csrfmiddlewaretoken: csrf_token,
              'nonce': nonce_id,
            }
            $.ajax({
              data: data,
              method: 'POST',
              url: '/donation/review',
              success: function(data){
                $('#review-amount').html('<b>Donation Amount:</b> $'+ amount)
                $('#review-frequency').html('<b>Donation Frequency:</b> '+frequencyVerbose)
                $('#review-nonce').html('<b>Payment Method:</b> '+ data['details'].card_type +' ending in '+ data['details'].last_four)
                $('#preloader').hide()
                $('.step-3').removeClass('hidden')
              },
              error: function(){
                Swal.fire(
                  'An Error Occured',
                  'Please Try Again',
                  'error'
                )
              }
            });
  };
})
</script>
<script>
  $('[name="donation_level"]').on('change', function(){
      var level = $(this).val()
      $('#donation-level-input').attr('value', level)
    });
    $('#other-donation').on('keyup', function(){
      var level = $(this).val()
      $('#donation-level-input').attr('value', level)
      $('#frequency-input').attr('value', 'once')
      $('#frequency-verbose-input').attr('value', 'One Time Donation')
    });
    $('[name="frequency"]').on('change', function(){
      var frequency = $(this).val()
      var frequencyVerbose = $(this).attr('confirm-display')
      $('#frequency-input').attr('value', frequency)
      $('#frequency-verbose-input').attr('value', frequencyVerbose)
    });
    $('.step1-next').click(function(event){
      event.preventDefault();
      $('.step-1').addClass('hidden')
      $('.step-2').removeClass('hidden')
    });
    $('.step1-create').click(function(event){
      event.preventDefault();
      $('.step-1').addClass('hidden');
      window.scrollTo(0, 0);
      $('#preloader').show();
      $(this).addClass('step1-next')
      $(this).removeClass('step1-create')
      var amount = $('#donation-level-input').val()
      var frequency = $('#frequency-input').val()
      var donor_first = $('#id_first_name').val()
      var donor_last = $('#last_name').val()
      var donor_email = $('#email').val()
      var donor_phone = $('#phone').val()
      var name = String(donor_first + donor_last)
      var mailing_1 = $('#id_address_line_1').val()
      var mailing_2 = $('#id_address_line_2').val()
      var mailing_city = $('#id_city').val()
      var mailing_state = $('#id_state').val()
      var mailing_zip = $('#id_zip').val()
      var csrf_token = $('[name="csrfmiddlewaretoken"]').val()
      data = {
        csrfmiddlewaretoken: csrf_token,
        'amount': amount,
        'frequency': frequency,
        'donor_first': donor_first,
        'donor_last': donor_last,
        'donor_email': donor_email,
        'donor_phone': donor_phone,
        'name': name,
        'mailing_1': mailing_1,
        'mailing_2': mailing_2,
        'mailing_city': mailing_city,
        'mailing_state': mailing_state,
        'mailing_zip': mailing_zip,
      }
      $.ajax({
        url: '/donation/create',
        method: 'POST',
        data: data,
        success: function(data){
          $('#preloader').hide();
          $('.step-2').removeClass('hidden');
        },
        error: function(data){
          Swal.fire(
            'An Error Occured',
            'Please try again',
            'error'
          )
        }
      })
      
    });
    $('#step2-back').click(function(){
      $('.step-2').addClass('hidden')
      $('.step-1').removeClass('hidden')
    });
    $('#step3-back').click(function(){
      $('.step-3').addClass('hidden')
      $('.step-2').removeClass('hidden')
    });
    
    $(":radio[value=25]").change(function() {
        
        $('#other-donation').val('');
        $('.other-input').addClass('hidden');
        $('#make-my-donation').show()
    });
    $(":radio[value=50]").change(function() {
        
        $('#other-donation').val('');
        $('.other-input').addClass('hidden');
        $('#make-my-donation').show()
    });
    $(":radio[value=100]").change(function() {
        
        $('#other-donation').val('');
        $('.other-input').addClass('hidden');
        $('#make-my-donation').show()
    });
    $(":radio[value=500]").change(function() {
        
        $('#other-donation').val('');
        $('.other-input').addClass('hidden');
        $('#make-my-donation').show()
    });
    $(":radio[value=1000]").change(function() {
        
        $('.other-input').addClass('hidden');
        $('#other-donation').val('');
        $('#make-my-donation').show()
    });
    $(":radio[value=5000]").change(function() {
        
        $('.other-input').addClass('hidden');
        $('#other-donation').val('');
        $('#make-my-donation').show()
    });
    $(":radio[value=10000]").change(function() {
        
        $('.other-input').addClass('hidden');
        $('#other-donation').val('');
        $('#make-my-donation').show()
    });
    $(":radio[value=15000]").change(function() {
        
        $('.other-input').addClass('hidden');
        $('#other-donation').val('');
        $('#make-my-donation').show()
    });
    $(":radio[value=25000]").change(function() {
        
        $('.other-input').addClass('hidden');
        $('#other-donation').val('');
        $('#make-my-donation').show()
    });
    $(".other").change(function() {
        $('.other-input').removeClass('hidden');
    });
    $('#other-donation').keyup(function(){
        var value = $(this).val();

    });
    $('.other').change(function(){
        $('#make-my-donation').hide();
        $('[value="once"]').prop('checked', true);
        
        
    })
    $('label').on('click', function(){
      $(this).addClass('active')
    });
    $('#add-new-billing').hide()
    $('[name="billing-address-group"]').on('change', function(){
      $('#add-new-billing').show();
      $('#billing-saved-or-new').attr('value', 'saved');
      $('#saved-billing-id').attr('value', 'saved');
      $('#new-billing-address-form').hide();
      $('#new-billing-address-form input').val('');
      
    });
    $('#new-billing-address-form input').on('keyup', function(){
      $('#billing-saved-or-new').attr('value', 'new');
    })
    $('#add-new-billing').on('click', function(){
    $('#new-billing-address-form').toggle();
    $('[name="billing-address-group"]').prop('checked', false)
  });
  $('#donation-submit-button').on('click', function(event){
    event.preventDefault();
    $('.step-3').addClass('hidden');
    window.scrollTo(0,0);
    $('#preloader').show();
    var csrf_token = $('[name="csrfmiddlewaretoken"]', '.step-3').val()
    var plan = $('[name="donation_level"]:checked').attr('plan-id')
    var data = {
      csrfmiddlewaretoken: csrf_token,
      'plan_id': plan,
    }
    $.ajax({
      data: data,
      url: '/donation/complete',
      method: 'POST',
      success: function(){
        $('#preloader').hide();
        Swal.fire(
          'Thank You!',
          'Your donation was processed successfully',
          'success',
        )
        $('.step-4').removeClass('hidden');
      }
    })
  })
</script>
<style>
  .p-title {
    font-family: oskar;
    font-size: 18px;
  }
  .donation-review-item {
    font-size: 18px;
    font-family: oskar;
  }
  #add-new-billing {
    background: rgb(41, 41, 41)
  }
  .address-label {
      font-size: 14px
    }
    label span {
      margin-bottom: -5px
    }
  .help-text{
    margin: 0;
    text-align: center;
  }
  .input-icon {
    font-size: 18px;
    color: rgb(160, 160, 160);
    margin-right: 10px
  }
  .checkout-fieldset {
    background: rgba(255, 255, 255, 0.632);
    border: none;
    border-radius: 15px;
    margin-top: 20px;
    margin-bottom: 20px;
    padding-left: 7%;
    padding-right: 7%;
    padding-bottom: 40px

  }
  .checkout-fieldset p {
    margin-bottom: 0;
    margin-top: 0px;
  }
  .secure-checkout {
    font-size: 14px;
    font-weight: 300;
    color: rgb(99, 99, 99);
  }
  .secure-checkout span {
    font-size: 16px
  }
  label {
    color: rgb(43, 43, 43) !important
  }
  .fieldset-title {
    font-family: oskar;
    font-size: 20px;
    color: rgb(186, 37, 37);
    text-decoration: underline;
  }
  .fieldset-subtitle {
    font-family: oskar;
    font-size: 18px;
    font-weight: 300;
    margin-top: 15px
  }
    .hidden {
        display: none;
    }
    
    #page {
        background-image: url("https://empowerthevillage.s3.amazonaws.com/static/img/VBP+collage.png");
        background-size: 100%;
        background-repeat: repeat;
    }
    .content-container {
    padding-top: 5%;
    background-color: rgba(255, 255, 255, 0.954);
    }
    .required {
        color: red
    }
    .label-title {
        font-size: 16px
    }
    .donate-buttons {
        padding-bottom: 60px
    }
    .donate-buttons a {
        width: 100%;
        margin:5px;
        font-size: 16px;
        letter-spacing: 1.5px;
        font-weight:400;
        height: 50px;
        padding-top:4px;
        border-radius: 40px;
    }
    .donate-buttons a i {
        font-size: 24px;
    }
    .donation-title {
        font-family: oskar-inline;
        font-size: 52px;
    }
    @media only screen and (min-width:0px){
        .donate-text-small {
          display: block;
        }
        .donate-text-large {
          display: none;
        }
        .donation-title {
            font-family: oskar-inline;
            font-size: 32px;
        }
        .donation-subtitle {
            font-size: 16px;
            font-weight: 300;
            line-height: 20px
        }
        .venmo-button {
          width: 95%;
          margin-left: 0;
        }
        .creditcard-button {
          width: 95%;
          font-size: 18px;
        }
        .google-button {
          width: 95%;
        }
        .paypal-button {
          width: 95%;
        }
        #paypal-button {
          width: 95%;
        }
        .applepay-button {
          width: 95%;
        }
        .paypal-button-row {
          height: 50px !important
        }
    }

    @media only screen and (min-width:601px){
      .p-title {
          font-family: oskar;
          font-size: 20px;
        }
        .donation-review-item {
    font-size: 20px;
    font-family: oskar;
  }
      .donate-text-small {
          display: none;
        }
        .donate-text-large {
          display: block;
          letter-spacing: 2px;
        }
        .donation-title {
            font-family: oskar-inline;
            font-size: 42px;
        }
        .venmo-button {
        }
        .fieldset-title {
          font-family: oskar;
          font-size: 24px
        }
        .content-container {
          margin-left: 3%;
          margin-right: 3%;
        }
    }
    @media only screen and (min-width:993px){
      .p-title {
          font-family: oskar;
          font-size: 26px;
        }
        .donation-review-item {
    font-size: 26px;
    font-family: oskar;
  }
        .donation-title {
            font-family: oskar-inline;
            font-size: 48px;
        }
        .donation-subtitle {
            font-size: 20px;
            font-weight: 300;
            line-height: 24px;
        }
        .venmo-button {
          font-size: 16px;
        }
        .creditcard-button {
          font-size: 20px;
        }
        .google-button {
          font-size: 16px;
        }
        .paypal-button {
          font-size: 16px;
        }
        .applepay-button {
          font-size: 16px;
        }
        .fieldset-title {
          font-family: oskar;
          font-size: 26px
        }
        .checkout-fieldset p {
          margin-bottom: 15px !important
        }
    }
    @media only screen and (min-width:1400px){
        .donation-title {
            font-family: oskar-inline;
            font-size: 56px;
        }
        .donation-subtitle {
            font-size: 20px;
            font-weight: 300;
            line-height: 24px
        }
        .fieldset-title {
          font-family: oskar;
          font-size: 28px
        }
    }
    .cc-button {
        background-color: rgb(55, 54, 54)
    }
    .cc-button:hover {
        background-color:rgb(101, 101, 101)
    }
    .pp-button {
        background-color: #3b7bbf
    }
    .pp-button:hover {
        background-color:#6799ce
    }
    .venmo-button {
        background-color: #3d95ce;
        color:white;
        margin:5px;
        letter-spacing: 1.5px;
        font-weight:500;
        height: 50px;
        line-height: 45px;
        border-radius: 40px;
    }
    .venmo-button:hover {
        background-color:#739296
    }
    .creditcard-button {
      background-color: #0f9a22;
      color:rgb(255, 255, 255);
        margin:5px;
        letter-spacing: 1.5px;
        font-weight:500;
        height: 50px;
        line-height: 40px;
        border-radius: 40px;
    }
    .creditcard-button:hover {
        background-color:#5e6a4b
    }
    .google-button {
      background-color: #fcfcfc;
      color:rgb(50, 50, 50);
        margin:5px;
        letter-spacing: 1.5px;
        font-weight:500;
        height: 50px;
        line-height: 45px;
        border-radius: 40px;
    }
    .google-button:hover {
        background-color:#ded8d8
    }
    .paypal-button {
      background-color: #ffffff;
      color:rgb(50, 50, 50);
        margin:5px;
        letter-spacing: 1.5px;
        font-weight:500;
        height: 50px;
        line-height: 45px;
        border-radius: 40px !important;
    }
    .paypal-button:hover {
        background-color:#d3d1da
    }
    .paypal-button-container{
      font-family: poppins !important;
      font-weight: 500;
      text-transform: uppercase !important;
    }
    .applepay-button {
      background-color: #181818;
      color:rgb(50, 50, 50);
        margin:5px;
        letter-spacing: 1.5px;
        font-weight:500;
        height: 50px;
        line-height: 45px;
        border-radius: 40px;
    }
    .applepay-button:hover {
        background-color:#5e5e5e
    }
    .paypal-button.paypal-button-color-white, .paypal-button-row.paypal-button-color-white .menu-button {
      border: none !important;
    }
    body {
  background-color: #fff;
}

.toast {
  position: fixed;
  top: 15px;
  right: 15px;
  z-index: 9999;
}

.bootstrap-basic {
  background: white;
}

#or {
  position: relative;
  line-height: 50px;
  text-align: center;
  font-weight: 500;
}

#or::before,
#or::after {
  position: absolute;
  width: 30%;
  height: 1px;
  
  top: 25px;
  
  background-color: rgb(193, 193, 193);
  
  content: '';
}

#or::before {
  left: 15%;
}

#or::after {
  right: 15%;
}
.btn:focus {
  background-color:rgb(160, 160, 160) !important;
}
#card-name {
  height: 3rem;
  border-bottom: 1px solid #9e9e9e;
  margin-bottom: 10px !important;
}
#card-number {
  height: 3rem;
  border-bottom: 1px solid #9e9e9e;
  margin-bottom: 10px !important;
}
#card-date {
  height: 3rem;
  border-bottom: 1px solid #9e9e9e;
  margin-bottom: 10px !important;
}
#card-cvv {
  height: 3rem;
  border-bottom: 1px solid #9e9e9e;
  margin-bottom: 10px !important;
}
#card-zip {
  height: 3rem ;
  border-bottom: 1px solid #9e9e9e;
  margin-bottom: 10px !important;
}
::placeholder {
  color: rgb(186, 186, 186) !important
}
</style>

{% endblock %}